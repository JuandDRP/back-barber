function a1_0x530e(_0x5bccde,_0x5dc4ed){const _0x2a8272=a1_0x2a82();return a1_0x530e=function(_0x530e9f,_0x2ea823){_0x530e9f=_0x530e9f-0xb3;let _0x324df4=_0x2a8272[_0x530e9f];return _0x324df4;},a1_0x530e(_0x5bccde,_0x5dc4ed);}const a1_0x471152=a1_0x530e;(function(_0x3903aa,_0x452c92){const _0x49ddd7=a1_0x530e,_0x504140=_0x3903aa();while(!![]){try{const _0x34780c=parseInt(_0x49ddd7(0xbe))/0x1*(parseInt(_0x49ddd7(0xc5))/0x2)+parseInt(_0x49ddd7(0xff))/0x3*(parseInt(_0x49ddd7(0xeb))/0x4)+parseInt(_0x49ddd7(0xd0))/0x5+parseInt(_0x49ddd7(0x102))/0x6+-parseInt(_0x49ddd7(0xc3))/0x7*(-parseInt(_0x49ddd7(0xd4))/0x8)+parseInt(_0x49ddd7(0xdd))/0x9+parseInt(_0x49ddd7(0xc2))/0xa*(-parseInt(_0x49ddd7(0xc1))/0xb);if(_0x34780c===_0x452c92)break;else _0x504140['push'](_0x504140['shift']());}catch(_0x5ba187){_0x504140['push'](_0x504140['shift']());}}}(a1_0x2a82,0xdfaa9));function a1_0x2a82(){const _0x4ed068=['regaladas','listen','updateOne','FhwPD','Disponibilidad\x20actualizada\x20correctamente','1187950lwGNlH','/reservar','Error\x20en\x20login:','nodemailer','24wbUwJx','/disponibilidad','barberia.luxury.cj@gmail.com','createTransport','KsFtA','send','/eliminarReserva','includes','Tbqey','15298578qJVFrI','QgsoI','params','use','get','express','findOne','Barbero\x20no\x20válido.\x20Solo\x20se\x20permiten\x20Juan\x20o\x20Camilo.','$peluqueadas','Credenciales\x20inválidas','Faltan\x20datos:\x20nombre\x20cliente,numero\x20celular,\x20barbero,\x20fecha\x20u\x20hora','deletedCount','clientes','Faltan\x20datos:\x20barbero,\x20fecha,\x20hora\x20o\x20numeroCelular','8sUePEl','/disponibilidad/:barbero/:fecha','body','📅\x20Nueva\x20Reserva\x20en\x20Barbería\x20Luxury','TkVtD','🚀\x20Servidor\x20escuchando\x20en\x20http://localhost:3001','Reserva\x20no\x20encontrada','UxOyc','JTGCA','admin','toArray','gotDt','map','xsgfA','Faltan\x20datos:\x20barbero,\x20fecha\x20u\x20horas','log','/clientes','disponibilidades','ApSAg','iUESi','1098936BGxPuA','Nueva\x20reserva:\x0a\x0aCliente:\x20','gmail','8555538lwRzON','OeGYh','BrHtA','json','LSZBl','Faltan\x20datos','Horario\x20ya\x20reservado','Juan','CcJLG','/reservas/:fecha','✉️\x20Correo\x20enviado:','filter','qSZNC','Reserva\x20realizada\x20con\x20éxito','Reserva\x20eliminada\x20y\x20cliente\x20actualizado','UBqbe','\x0aFecha:\x20','\x0aHora:\x20','Camilo','Error\x20del\x20servidor','\x0aBarbero:\x20','collection','xohcM','UxIoo','trgbbrmghtdywhlk','horas','FCDJW','Error\x20al\x20eliminar\x20la\x20reserva','deleteOne','sacFT','error','hora','post','reservas','xYeKK','peluqueadas','response','ZEUSC','find','status','No\x20hay\x20disponibilidad\x20configurada','355669aHVAXI','then','./db','407RfPmbb','1540550VvxBZD','2560873xIIKpG','RqBhM','8XdYQKe','/ping','\x0aCelular:\x20','KlaWd','BgXXM','WLYva'];a1_0x2a82=function(){return _0x4ed068;};return a1_0x2a82();}const express=require(a1_0x471152(0xe2)),app=express(),cors=require('cors'),conectarDB=require(a1_0x471152(0xc0)),nodemailer=require(a1_0x471152(0xd3));app['use'](cors()),app[a1_0x471152(0xe0)](express['json']());let db,reservasCol,disponibilidadesCol,clientesCol;conectarDB()[a1_0x471152(0xbf)](_0x576acb=>{const _0x4aa4d5=a1_0x471152,_0x13b892={'qfRFc':_0x4aa4d5(0xf0),'iUESi':_0x4aa4d5(0xfc),'ZEUSC':_0x4aa4d5(0xe9)};db=_0x576acb,reservasCol=db['collection']('reservas'),disponibilidadesCol=db[_0x4aa4d5(0x117)](_0x13b892[_0x4aa4d5(0xfe)]),clientesCol=db[_0x4aa4d5(0x117)](_0x13b892[_0x4aa4d5(0xba)]),app[_0x4aa4d5(0xcc)](0xbb9,()=>{const _0x36148d=_0x4aa4d5;console[_0x36148d(0xfa)](_0x13b892['qfRFc']);});}),app['get'](a1_0x471152(0xc6),(_0x378e5,_0x3d5768)=>_0x3d5768['sendStatus'](0xc8)),app[a1_0x471152(0xe1)]('/',(_0x3eb28f,_0x212d53)=>{const _0x16be90=a1_0x471152,_0x42aa73={'UxOyc':'Hola\x20desde\x20Express\x20y\x20MongoDB\x20🚀'};_0x212d53[_0x16be90(0xd9)](_0x42aa73[_0x16be90(0xf2)]);}),app[a1_0x471152(0xe1)](a1_0x471152(0xec),async(_0x211a67,_0x1564ab)=>{const _0x5187f3=a1_0x471152,_0x13f9dc={'KsFtA':_0x5187f3(0x109),'xohcM':_0x5187f3(0x114),'UBqbe':_0x5187f3(0xe4),'rFEAm':_0x5187f3(0xbd)},{barbero:_0x2403db,fecha:_0x1f8b81}=_0x211a67[_0x5187f3(0xdf)],_0x2aeeb8=[_0x13f9dc[_0x5187f3(0xd8)],_0x13f9dc[_0x5187f3(0x118)]];if(!_0x2aeeb8[_0x5187f3(0xdb)](_0x2403db))return _0x1564ab[_0x5187f3(0xbc)](0x190)[_0x5187f3(0x105)]({'error':_0x13f9dc[_0x5187f3(0x111)]});const _0x1aabbf=await disponibilidadesCol[_0x5187f3(0xe3)]({'barbero':_0x2403db,'fecha':_0x1f8b81});if(!_0x1aabbf)return _0x1564ab['status'](0x194)[_0x5187f3(0x105)]({'error':_0x13f9dc['rFEAm']});const _0x46591f=await reservasCol[_0x5187f3(0xbb)]({'barbero':_0x2403db,'fecha':_0x1f8b81})['toArray'](),_0x2a6e9a=_0x46591f[_0x5187f3(0xf7)](_0x15871c=>_0x15871c[_0x5187f3(0xb4)]),_0x5ef1ee=_0x1aabbf[_0x5187f3(0x11b)][_0x5187f3(0x10d)](_0x31b616=>!_0x2a6e9a[_0x5187f3(0xdb)](_0x31b616));_0x1564ab[_0x5187f3(0x105)]({'barbero':_0x2403db,'fecha':_0x1f8b81,'disponibles':_0x5ef1ee});}),app['get'](a1_0x471152(0xfb),async(_0x401ac0,_0x5430ab)=>{const _0x3cb5fb=a1_0x471152,_0x45dbd8=await db[_0x3cb5fb(0x117)](_0x3cb5fb(0xe9))['find']({})[_0x3cb5fb(0xf5)]();_0x5430ab[_0x3cb5fb(0x105)](_0x45dbd8);}),app[a1_0x471152(0xe1)](a1_0x471152(0x10b),async(_0x35cc50,_0x4e01da)=>{const _0x3e3e9b=a1_0x471152,{fecha:_0x2f766d}=_0x35cc50['params'],_0x2c9690=await db[_0x3e3e9b(0x117)](_0x3e3e9b(0xb6))[_0x3e3e9b(0xbb)]({'fecha':_0x2f766d})[_0x3e3e9b(0xf5)]();_0x4e01da[_0x3e3e9b(0x105)](_0x2c9690);}),app[a1_0x471152(0xb5)](a1_0x471152(0xd1),async(_0x397063,_0x4ee3a3)=>{const _0x1eec71=a1_0x471152,_0x14762f={'BgXXM':'❌\x20Error\x20al\x20enviar\x20correo:','gotDt':_0x1eec71(0x10c),'UxIoo':_0x1eec71(0x109),'FhwPD':_0x1eec71(0x114),'QgsoI':_0x1eec71(0xe4),'oymtl':_0x1eec71(0x108),'FCDJW':function(_0xeae4b5,_0x2cbd36){return _0xeae4b5>=_0x2cbd36;},'RqBhM':function(_0x32f3bd,_0x3f5801){return _0x32f3bd+_0x3f5801;},'LSZBl':function(_0x5e8fb5,_0x55af74){return _0x5e8fb5+_0x55af74;},'CcJLG':_0x1eec71(0x11a),'caJIg':'juandrp2004@gmail.com','qSZNC':_0x1eec71(0xee)},{nombreCliente:_0x2f4d98,numeroCelular:_0x40cb37,barbero:_0x5337d0,fecha:_0x292047,hora:_0x16899e}=_0x397063['body'];if(!_0x2f4d98||!_0x40cb37||!_0x5337d0||!_0x292047||!_0x16899e)return _0x4ee3a3['status'](0x190)[_0x1eec71(0x105)]({'error':_0x1eec71(0xe7)});const _0x2968a3=[_0x14762f[_0x1eec71(0x119)],_0x14762f[_0x1eec71(0xce)]];if(!_0x2968a3[_0x1eec71(0xdb)](_0x5337d0))return _0x4ee3a3['status'](0x190)['json']({'error':_0x14762f[_0x1eec71(0xde)]});const _0x2041ef=await reservasCol['findOne']({'barbero':_0x5337d0,'fecha':_0x292047,'hora':_0x16899e});if(_0x2041ef)return _0x4ee3a3[_0x1eec71(0xbc)](0x190)[_0x1eec71(0x105)]({'error':_0x14762f['oymtl']});const _0x5d6e62={'nombreCliente':_0x2f4d98,'numeroCelular':_0x40cb37,'barbero':_0x5337d0,'fecha':_0x292047,'hora':_0x16899e};await reservasCol['insertOne'](_0x5d6e62);const _0xf0f827=await clientesCol[_0x1eec71(0xe3)]({'numeroCelular':_0x40cb37});let _0x3086c3=0x1,_0x25b48c=0x0;if(_0xf0f827){const _0x5549d5=_0xf0f827[_0x1eec71(0xb8)]||0x0,_0x44af32=_0xf0f827[_0x1eec71(0xcb)]||0x0;_0x14762f[_0x1eec71(0x11c)](_0x5549d5,0x7)?(_0x3086c3=0x1,_0x25b48c=_0x14762f[_0x1eec71(0xc4)](_0x44af32,0x1)):(_0x3086c3=_0x14762f[_0x1eec71(0x106)](_0x5549d5,0x1),_0x25b48c=_0x44af32),await clientesCol[_0x1eec71(0xcd)]({'numeroCelular':_0x40cb37},{'$set':{'nombreCliente':_0x2f4d98,'peluqueadas':_0x3086c3,'regaladas':_0x25b48c}});}else await clientesCol['insertOne']({'numeroCelular':_0x40cb37,'nombreCliente':_0x2f4d98,'peluqueadas':0x1,'regaladas':0x0});const _0x17edf1=nodemailer[_0x1eec71(0xd7)]({'service':_0x1eec71(0x101),'auth':{'user':_0x1eec71(0xd6),'pass':_0x14762f[_0x1eec71(0x10a)]}}),_0x5a2214={'from':_0x1eec71(0xd6),'to':[_0x14762f['caJIg'],'maycamilo3@gmail.com'],'subject':_0x14762f[_0x1eec71(0x10e)],'text':_0x1eec71(0x100)+_0x2f4d98+_0x1eec71(0xc7)+_0x40cb37+_0x1eec71(0x116)+_0x5337d0+_0x1eec71(0x112)+_0x292047+_0x1eec71(0x113)+_0x16899e};_0x17edf1['sendMail'](_0x5a2214,(_0x2f59b2,_0x6b4bb2)=>{const _0x365c8a=_0x1eec71;_0x2f59b2?console[_0x365c8a(0xb3)](_0x14762f[_0x365c8a(0xc9)],_0x2f59b2):console['log'](_0x14762f[_0x365c8a(0xf6)],_0x6b4bb2[_0x365c8a(0xb9)]);}),_0x4ee3a3[_0x1eec71(0xbc)](0xc9)[_0x1eec71(0x105)]({'mensaje':_0x1eec71(0x10f),'reserva':_0x5d6e62,'peluqueadas':_0x3086c3,'regaladas':_0x25b48c});}),app[a1_0x471152(0xb5)](a1_0x471152(0xd5),async(_0x3a3a9a,_0xfe9484)=>{const _0x138460=a1_0x471152,_0x3722d5={'xsgfA':function(_0x200c33,_0x5b6f23){return _0x200c33||_0x5b6f23;},'sacFT':_0x138460(0xf9),'JTGCA':_0x138460(0x109),'WzUge':_0x138460(0x114),'KlaWd':'Barbero\x20no\x20válido.\x20Solo\x20se\x20permiten\x20Juan\x20o\x20Camilo.'},{barbero:_0x3e4fc8,fecha:_0x37421d,horas:_0x2bcc1f}=_0x3a3a9a[_0x138460(0xed)];if(_0x3722d5[_0x138460(0xf8)](!_0x3e4fc8,!_0x37421d)||!Array['isArray'](_0x2bcc1f))return _0xfe9484['status'](0x190)[_0x138460(0x105)]({'error':_0x3722d5[_0x138460(0x11f)]});const _0x3c3d77=[_0x3722d5[_0x138460(0xf3)],_0x3722d5['WzUge']];if(!_0x3c3d77[_0x138460(0xdb)](_0x3e4fc8))return _0xfe9484['status'](0x190)[_0x138460(0x105)]({'error':_0x3722d5[_0x138460(0xc8)]});const _0x1617bc=await disponibilidadesCol[_0x138460(0xcd)]({'barbero':_0x3e4fc8,'fecha':_0x37421d},{'$addToSet':{'horas':{'$each':_0x2bcc1f}}},{'upsert':!![]});_0xfe9484[_0x138460(0xbc)](0xc9)[_0x138460(0x105)]({'mensaje':_0x138460(0xcf)});}),app[a1_0x471152(0xb5)]('/login',async(_0x114943,_0x445a51)=>{const _0x4f6ed4=a1_0x471152,_0x24127d={'TkVtD':_0x4f6ed4(0x107),'ApSAg':_0x4f6ed4(0xf4),'sKVqa':_0x4f6ed4(0xe6),'sMDYV':_0x4f6ed4(0xd2),'OeGYh':_0x4f6ed4(0x115)},{usuario:_0x243162,contrasena:_0x5d7250}=_0x114943[_0x4f6ed4(0xed)];if(!_0x243162||!_0x5d7250)return _0x445a51[_0x4f6ed4(0xbc)](0x190)[_0x4f6ed4(0x105)]({'acceso':![],'mensaje':_0x24127d[_0x4f6ed4(0xef)]});try{const _0x285f8a=db[_0x4f6ed4(0x117)](_0x24127d[_0x4f6ed4(0xfd)]),_0x4398dd=await _0x285f8a[_0x4f6ed4(0xe3)]({'usuario':_0x243162,'contrasena':_0x5d7250});return _0x4398dd?_0x445a51[_0x4f6ed4(0x105)]({'acceso':!![]}):_0x445a51[_0x4f6ed4(0xbc)](0x191)[_0x4f6ed4(0x105)]({'acceso':![],'mensaje':_0x24127d['sKVqa']});}catch(_0x5b7d62){return console[_0x4f6ed4(0xb3)](_0x24127d['sMDYV'],_0x5b7d62),_0x445a51[_0x4f6ed4(0xbc)](0x1f4)[_0x4f6ed4(0x105)]({'acceso':![],'mensaje':_0x24127d[_0x4f6ed4(0x103)]});}}),app[a1_0x471152(0xb5)](a1_0x471152(0xda),async(_0x38cf81,_0x52c2ed)=>{const _0x3911db=a1_0x471152,_0x20c92b={'xYeKK':function(_0x4b58ab,_0x334a82){return _0x4b58ab||_0x334a82;},'Tbqey':_0x3911db(0xf1),'BrHtA':_0x3911db(0xe5),'WLYva':'Error\x20al\x20eliminar\x20reserva:'},{barbero:_0x4b04c5,fecha:_0x5874c8,hora:_0x20faac,numeroCelular:_0x1d2e58}=_0x38cf81[_0x3911db(0xed)];if(_0x20c92b[_0x3911db(0xb7)](!_0x4b04c5,!_0x5874c8)||!_0x20faac||!_0x1d2e58)return _0x52c2ed['status'](0x190)['json']({'error':_0x3911db(0xea)});try{const _0x26d0dc=await reservasCol[_0x3911db(0x11e)]({'barbero':_0x4b04c5,'fecha':_0x5874c8,'hora':_0x20faac,'numeroCelular':_0x1d2e58});if(_0x26d0dc[_0x3911db(0xe8)]===0x0)return _0x52c2ed[_0x3911db(0xbc)](0x194)[_0x3911db(0x105)]({'error':_0x20c92b[_0x3911db(0xdc)]});await clientesCol['updateOne']({'numeroCelular':_0x1d2e58},[{'$set':{'peluqueadas':{'$cond':[{'$gt':[_0x20c92b[_0x3911db(0x104)],0x0]},{'$subtract':[_0x20c92b[_0x3911db(0x104)],0x1]},0x0]}}}]),_0x52c2ed[_0x3911db(0x105)]({'mensaje':_0x3911db(0x110)});}catch(_0xfcb0f9){console['error'](_0x20c92b[_0x3911db(0xca)],_0xfcb0f9),_0x52c2ed[_0x3911db(0xbc)](0x1f4)[_0x3911db(0x105)]({'error':_0x3911db(0x11d)});}});