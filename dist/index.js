const a1_0x5660c2=a1_0xe64b;(function(_0x228c51,_0x1095de){const _0x2b01d5=a1_0xe64b,_0x4cf543=_0x228c51();while(!![]){try{const _0x1bec3b=-parseInt(_0x2b01d5(0x8c))/0x1*(-parseInt(_0x2b01d5(0x7d))/0x2)+-parseInt(_0x2b01d5(0xbb))/0x3*(parseInt(_0x2b01d5(0xc2))/0x4)+parseInt(_0x2b01d5(0xd0))/0x5*(parseInt(_0x2b01d5(0x7e))/0x6)+-parseInt(_0x2b01d5(0xa5))/0x7*(parseInt(_0x2b01d5(0xae))/0x8)+-parseInt(_0x2b01d5(0xd2))/0x9+parseInt(_0x2b01d5(0xc7))/0xa*(parseInt(_0x2b01d5(0x6d))/0xb)+parseInt(_0x2b01d5(0xb1))/0xc*(-parseInt(_0x2b01d5(0xa4))/0xd);if(_0x1bec3b===_0x1095de)break;else _0x4cf543['push'](_0x4cf543['shift']());}catch(_0x40c188){_0x4cf543['push'](_0x4cf543['shift']());}}}(a1_0x2c15,0x80cc1));const express=require('express'),app=express(),cors=require('cors'),conectarDB=require(a1_0x5660c2(0xcb)),sgMail=require(a1_0x5660c2(0xc4));require(a1_0x5660c2(0xb3))[a1_0x5660c2(0xb9)](),sgMail[a1_0x5660c2(0x99)](process[a1_0x5660c2(0xcf)][a1_0x5660c2(0xbd)]),app[a1_0x5660c2(0xce)](cors()),app[a1_0x5660c2(0xce)](express['json']());let db,reservasCol,disponibilidadesCol,clientesCol;conectarDB()[a1_0x5660c2(0xd7)](_0x3ded2b=>{const _0x2935c5=a1_0x5660c2,_0x568b55={'iBhdz':'üöÄ\x20Servidor\x20escuchando\x20en\x20http://localhost:3001','wlTWv':_0x2935c5(0xb5),'aujjA':_0x2935c5(0xde),'vNnbR':_0x2935c5(0xa2)};db=_0x3ded2b,reservasCol=db[_0x2935c5(0xb2)](_0x568b55['wlTWv']),disponibilidadesCol=db[_0x2935c5(0xb2)](_0x568b55[_0x2935c5(0x79)]),clientesCol=db[_0x2935c5(0xb2)](_0x568b55[_0x2935c5(0xd6)]),app[_0x2935c5(0xb7)](0xbb9,()=>{const _0x3627f2=_0x2935c5;console[_0x3627f2(0xac)](_0x568b55[_0x3627f2(0x93)]);});}),app['get'](a1_0x5660c2(0x75),(_0xc86bf6,_0x48c02b)=>_0x48c02b['sendStatus'](0xc8)),app[a1_0x5660c2(0x82)]('/',(_0x41a768,_0x3cb96d)=>{const _0xc3bab5=a1_0x5660c2,_0x3c1abe={'pApFQ':_0xc3bab5(0xd1)};_0x3cb96d[_0xc3bab5(0x76)](_0x3c1abe[_0xc3bab5(0x9a)]);}),app[a1_0x5660c2(0x82)](a1_0x5660c2(0xb4),async(_0x38b6b3,_0x4ef9f7)=>{const _0x307025=a1_0x5660c2,_0xbd5045={'zqqrs':_0x307025(0x9f),'CUDZD':_0x307025(0x70),'KpDyQ':_0x307025(0x8f)},{barbero:_0x503eee,fecha:_0x3608bc}=_0x38b6b3[_0x307025(0x77)],_0xfaa89=[_0xbd5045['zqqrs'],_0xbd5045[_0x307025(0xd4)]];if(!_0xfaa89[_0x307025(0xc5)](_0x503eee))return _0x4ef9f7[_0x307025(0xad)](0x190)[_0x307025(0xb6)]({'error':_0x307025(0xbc)});const _0x21ee1a=await disponibilidadesCol[_0x307025(0x71)]({'barbero':_0x503eee,'fecha':_0x3608bc});if(!_0x21ee1a)return _0x4ef9f7['status'](0x194)[_0x307025(0xb6)]({'error':_0xbd5045[_0x307025(0x9c)]});const _0x1832cd=await reservasCol[_0x307025(0xd8)]({'barbero':_0x503eee,'fecha':_0x3608bc})[_0x307025(0xc0)](),_0x1c7c69=_0x1832cd[_0x307025(0x97)](_0x6d24e3=>_0x6d24e3[_0x307025(0xd3)]),_0x969d85=_0x21ee1a[_0x307025(0x9b)][_0x307025(0xdf)](_0x49e2e0=>!_0x1c7c69[_0x307025(0xc5)](_0x49e2e0));_0x4ef9f7[_0x307025(0xb6)]({'barbero':_0x503eee,'fecha':_0x3608bc,'disponibles':_0x969d85});}),app[a1_0x5660c2(0x82)](a1_0x5660c2(0xa3),async(_0x308fbb,_0x3a7f75)=>{const _0x1e3a7f=a1_0x5660c2,_0x150f91=await db[_0x1e3a7f(0xb2)](_0x1e3a7f(0xa2))[_0x1e3a7f(0xd8)]({})[_0x1e3a7f(0xc0)]();_0x3a7f75[_0x1e3a7f(0xb6)](_0x150f91);}),app[a1_0x5660c2(0x82)](a1_0x5660c2(0x9d),async(_0x1920b4,_0x3516a2)=>{const _0x20c6e5=a1_0x5660c2,_0x5ae6fb={'cFPBa':'reservas'},{fecha:_0x461f77}=_0x1920b4[_0x20c6e5(0x77)],_0xe32af8=await db['collection'](_0x5ae6fb[_0x20c6e5(0x92)])[_0x20c6e5(0xd8)]({'fecha':_0x461f77})[_0x20c6e5(0xc0)]();_0x3516a2[_0x20c6e5(0xb6)](_0xe32af8);}),app[a1_0x5660c2(0xaf)](a1_0x5660c2(0xdc),async(_0x103494,_0x11ace1)=>{const _0x24937a=a1_0x5660c2,_0x306df4={'MjEyY':function(_0x116103,_0x5a2daa){return _0x116103||_0x5a2daa;},'UnvkQ':_0x24937a(0x9f),'Egihv':'Barbero\x20no\x20v√°lido.\x20Solo\x20se\x20permiten\x20Juan\x20o\x20Camilo.','CPVQo':'Horario\x20ya\x20reservado','pCsAJ':function(_0xfc942c,_0xa21df1){return _0xfc942c>=_0xa21df1;},'YOlKX':function(_0x8fa95b,_0x55f2ce){return _0x8fa95b+_0x55f2ce;},'fZMhH':_0x24937a(0xc9),'SbvvP':_0x24937a(0xd9),'kTeXy':_0x24937a(0x81),'FYWhS':_0x24937a(0x8b),'GkjSE':'‚ùå\x20Error\x20al\x20enviar\x20correo:','Wuizs':_0x24937a(0xb0)},{nombreCliente:_0x5bf698,numeroCelular:_0x57a574,barbero:_0x787fe4,fecha:_0x266be6,hora:_0x697d60}=_0x103494[_0x24937a(0xe0)];if(_0x306df4['MjEyY'](!_0x5bf698,!_0x57a574)||!_0x787fe4||!_0x266be6||!_0x697d60)return _0x11ace1['status'](0x190)[_0x24937a(0xb6)]({'error':_0x24937a(0xda)});const _0x10755a=[_0x306df4[_0x24937a(0x72)],_0x24937a(0x70)];if(!_0x10755a['includes'](_0x787fe4))return _0x11ace1[_0x24937a(0xad)](0x190)[_0x24937a(0xb6)]({'error':_0x306df4[_0x24937a(0x73)]});const _0x2456a0=await reservasCol[_0x24937a(0x71)]({'barbero':_0x787fe4,'fecha':_0x266be6,'hora':_0x697d60});if(_0x2456a0)return _0x11ace1['status'](0x190)[_0x24937a(0xb6)]({'error':_0x306df4[_0x24937a(0x78)]});const _0x5b8188={'nombreCliente':_0x5bf698,'numeroCelular':_0x57a574,'barbero':_0x787fe4,'fecha':_0x266be6,'hora':_0x697d60};await reservasCol[_0x24937a(0xc6)](_0x5b8188);const _0x106aa1=await clientesCol[_0x24937a(0x71)]({'numeroCelular':_0x57a574});let _0x5268c1=0x1,_0x2309a2=0x0;if(_0x106aa1){const _0x1f5b1e=_0x106aa1[_0x24937a(0xa8)]||0x0,_0x2fe15e=_0x106aa1[_0x24937a(0x88)]||0x0;_0x306df4[_0x24937a(0xcd)](_0x1f5b1e,0x7)?(_0x5268c1=0x1,_0x2309a2=_0x2fe15e+0x1):(_0x5268c1=_0x306df4[_0x24937a(0x6c)](_0x1f5b1e,0x1),_0x2309a2=_0x2fe15e),await clientesCol[_0x24937a(0xd5)]({'numeroCelular':_0x57a574},{'$set':{'nombreCliente':_0x5bf698,'peluqueadas':_0x5268c1,'regaladas':_0x2309a2}});}else await clientesCol[_0x24937a(0xc6)]({'numeroCelular':_0x57a574,'nombreCliente':_0x5bf698,'peluqueadas':0x1,'regaladas':0x0});const _0x21419c={'to':_0x306df4[_0x24937a(0x8a)],'from':_0x24937a(0x90),'cc':_0x306df4['SbvvP'],'subject':_0x24937a(0x7f),'text':'Prueba','html':_0x24937a(0xc3)+_0x5bf698+_0x24937a(0xb8)+_0x57a574+_0x24937a(0xbf)+_0x787fe4+_0x24937a(0xca)+_0x266be6+'\x20<br>‚è∞Hora:\x20'+_0x697d60};try{console['log'](_0x24937a(0x7a));const [_0x1a7c2b]=await sgMail[_0x24937a(0x76)](_0x21419c);console['log'](_0x306df4[_0x24937a(0x96)],_0x1a7c2b[_0x24937a(0x94)]),console['log'](_0x306df4[_0x24937a(0x8e)]);}catch(_0x24744f){console[_0x24937a(0x9e)](_0x306df4['GkjSE'],_0x24744f[_0x24937a(0x7c)]?.[_0x24937a(0xe0)]||_0x24744f);}_0x11ace1[_0x24937a(0xad)](0xc9)[_0x24937a(0xb6)]({'mensaje':_0x306df4[_0x24937a(0xa7)],'reserva':_0x5b8188,'peluqueadas':_0x5268c1,'regaladas':_0x2309a2});}),app['post'](a1_0x5660c2(0xdb),async(_0x4a0c42,_0x25358e)=>{const _0x45b139=a1_0x5660c2,_0x4bbfe1={'JfHMG':function(_0x1ed8dc,_0x4c6fef){return _0x1ed8dc||_0x4c6fef;},'WgBxa':_0x45b139(0xcc),'LkjDW':'Juan','RiQqj':_0x45b139(0xbc),'Egwns':_0x45b139(0x6f)},{barbero:_0x45cc2b,fecha:_0x5861bb,horas:_0xa7bae9}=_0x4a0c42[_0x45b139(0xe0)];if(_0x4bbfe1[_0x45b139(0x98)](!_0x45cc2b,!_0x5861bb)||!Array['isArray'](_0xa7bae9))return _0x25358e[_0x45b139(0xad)](0x190)[_0x45b139(0xb6)]({'error':_0x4bbfe1[_0x45b139(0x86)]});const _0x2316da=[_0x4bbfe1[_0x45b139(0x84)],_0x45b139(0x70)];if(!_0x2316da[_0x45b139(0xc5)](_0x45cc2b))return _0x25358e[_0x45b139(0xad)](0x190)[_0x45b139(0xb6)]({'error':_0x4bbfe1['RiQqj']});const _0x247d4f=await disponibilidadesCol[_0x45b139(0xd5)]({'barbero':_0x45cc2b,'fecha':_0x5861bb},{'$addToSet':{'horas':{'$each':_0xa7bae9}}},{'upsert':!![]});_0x25358e['status'](0xc9)[_0x45b139(0xb6)]({'mensaje':_0x4bbfe1['Egwns']});}),app[a1_0x5660c2(0xaf)](a1_0x5660c2(0x8d),async(_0x22d9b8,_0x3a6c55)=>{const _0x350d7a=a1_0x5660c2,_0x5942a5={'oIUmd':function(_0x313653,_0x3b7808){return _0x313653||_0x3b7808;},'OijoR':_0x350d7a(0xbe),'KzDLX':_0x350d7a(0x80),'VokFP':'Credenciales\x20inv√°lidas','UWPQN':_0x350d7a(0xaa),'jWdhd':_0x350d7a(0xba)},{usuario:_0x5b1374,contrasena:_0x1573ac}=_0x22d9b8[_0x350d7a(0xe0)];if(_0x5942a5[_0x350d7a(0x83)](!_0x5b1374,!_0x1573ac))return _0x3a6c55[_0x350d7a(0xad)](0x190)[_0x350d7a(0xb6)]({'acceso':![],'mensaje':_0x5942a5[_0x350d7a(0x89)]});try{const _0x37702d=db[_0x350d7a(0xb2)](_0x5942a5[_0x350d7a(0xc1)]),_0x2307a5=await _0x37702d[_0x350d7a(0x71)]({'usuario':_0x5b1374,'contrasena':_0x1573ac});return _0x2307a5?_0x3a6c55['json']({'acceso':!![]}):_0x3a6c55[_0x350d7a(0xad)](0x191)[_0x350d7a(0xb6)]({'acceso':![],'mensaje':_0x5942a5[_0x350d7a(0x6e)]});}catch(_0x5ce743){return console[_0x350d7a(0x9e)](_0x5942a5[_0x350d7a(0xab)],_0x5ce743),_0x3a6c55[_0x350d7a(0xad)](0x1f4)[_0x350d7a(0xb6)]({'acceso':![],'mensaje':_0x5942a5[_0x350d7a(0xa0)]});}}),app[a1_0x5660c2(0xaf)](a1_0x5660c2(0x7b),async(_0x4ada7b,_0x552537)=>{const _0x13b20a=a1_0x5660c2,_0x971c5a={'zwzOd':function(_0x55296a,_0x3d0cc2){return _0x55296a||_0x3d0cc2;},'cEHSr':_0x13b20a(0xa9),'HHipM':function(_0x4898cb,_0x28b3cf){return _0x4898cb===_0x28b3cf;},'JKplW':'$peluqueadas','SBHQw':'Reserva\x20eliminada\x20y\x20cliente\x20actualizado','rnxYe':_0x13b20a(0xa1),'COqzn':'Error\x20al\x20eliminar\x20la\x20reserva'},{barbero:_0x2437e3,fecha:_0x340989,hora:_0x5e2503,numeroCelular:_0x46733e}=_0x4ada7b['body'];if(_0x971c5a['zwzOd'](!_0x2437e3,!_0x340989)||!_0x5e2503||!_0x46733e)return _0x552537[_0x13b20a(0xad)](0x190)[_0x13b20a(0xb6)]({'error':_0x971c5a[_0x13b20a(0xa6)]});try{const _0xaad7f6=await reservasCol[_0x13b20a(0x87)]({'barbero':_0x2437e3,'fecha':_0x340989,'hora':_0x5e2503,'numeroCelular':_0x46733e});if(_0x971c5a[_0x13b20a(0xc8)](_0xaad7f6[_0x13b20a(0x85)],0x0))return _0x552537[_0x13b20a(0xad)](0x194)[_0x13b20a(0xb6)]({'error':_0x13b20a(0x95)});await clientesCol['updateOne']({'numeroCelular':_0x46733e},[{'$set':{'peluqueadas':{'$cond':[{'$gt':[_0x13b20a(0x74),0x0]},{'$subtract':[_0x971c5a['JKplW'],0x1]},0x0]}}}]),_0x552537[_0x13b20a(0xb6)]({'mensaje':_0x971c5a[_0x13b20a(0xdd)]});}catch(_0xadeaa3){console['error'](_0x971c5a[_0x13b20a(0x91)],_0xadeaa3),_0x552537[_0x13b20a(0xad)](0x1f4)[_0x13b20a(0xb6)]({'error':_0x971c5a['COqzn']});}});function a1_0xe64b(_0x154b03,_0x421e70){const _0x2c15dc=a1_0x2c15();return a1_0xe64b=function(_0xe64be9,_0x251897){_0xe64be9=_0xe64be9-0x6c;let _0x36febc=_0x2c15dc[_0xe64be9];return _0x36febc;},a1_0xe64b(_0x154b03,_0x421e70);}function a1_0x2c15(){const _0x4abfa4=['1265635BFxlbN','cEHSr','Wuizs','peluqueadas','Faltan\x20datos:\x20barbero,\x20fecha,\x20hora\x20o\x20numeroCelular','Error\x20en\x20login:','UWPQN','log','status','24GkWBfF','post','Reserva\x20realizada\x20con\x20√©xito','516cTHsRc','collection','dotenv','/disponibilidad/:barbero/:fecha','reservas','json','listen','\x20<br>üì±Celular:\x20','config','Error\x20del\x20servidor','623781VTJgti','Barbero\x20no\x20v√°lido.\x20Solo\x20se\x20permiten\x20Juan\x20o\x20Camilo.','SENDGRID_API_KEY','Faltan\x20datos','\x20<br>üíàBarbero:\x20','toArray','KzDLX','4pxUcyD','üéâNueva\x20reserva:\x20<br>üë§Cliente:\x20','@sendgrid/mail','includes','insertOne','5148150CEhRMA','HHipM','maycamilo3@gmail.com','\x20<br>üìÖFecha:\x20','./db','Faltan\x20datos:\x20barbero,\x20fecha\x20u\x20horas','pCsAJ','use','env','5LGlrjh','Hola\x20desde\x20Express\x20y\x20MongoDB\x20üöÄ','6760386bAeOlj','hora','CUDZD','updateOne','vNnbR','then','find','juandrp2004@gmail.com','Faltan\x20datos:\x20nombre\x20cliente,numero\x20celular,\x20barbero,\x20fecha\x20u\x20hora','/disponibilidad','/reservar','SBHQw','disponibilidades','filter','body','YOlKX','11sbAcuY','VokFP','Disponibilidad\x20actualizada\x20correctamente','Camilo','findOne','UnvkQ','Egihv','$peluqueadas','/ping','send','params','CPVQo','aujjA','Intentar\x20enviar...','/eliminarReserva','response','262518fKbpdn','6002886OpxJos','üìÖ\x20Nueva\x20Reserva\x20en\x20Barber√≠a\x20Luxury','admin','üì®\x20Status\x20Code:','get','oIUmd','LkjDW','deletedCount','WgBxa','deleteOne','regaladas','OijoR','fZMhH','Correo\x20enviado','7MVKTCO','/login','FYWhS','No\x20hay\x20disponibilidad\x20configurada','barberia.luxury.cj@gmail.com','rnxYe','cFPBa','iBhdz','statusCode','Reserva\x20no\x20encontrada','kTeXy','map','JfHMG','setApiKey','pApFQ','horas','KpDyQ','/reservas/:fecha','error','Juan','jWdhd','Error\x20al\x20eliminar\x20reserva:','clientes','/clientes','122460WMtqwv'];a1_0x2c15=function(){return _0x4abfa4;};return a1_0x2c15();}